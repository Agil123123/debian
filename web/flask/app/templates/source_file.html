{#
  Copyright (C) 2013  Matthieu Caneill <matthieu.caneill@gmail.com>
  License: GNU Affero General Public License, version 3 or above.
#}

{% extends "source_base.html" %}

{% block head %}
  {{ super() }}

  <link rel="stylesheet"
        href="{{ config.HIGHLIGHT_JS_FOLDER }}/styles/{{ config.HIGHLIGHT_STYLE }}.css">
  <script src="{{ config.HIGHLIGHT_JS_FOLDER }}/highlight.min.js"></script>
  <link rel="stylesheet" type="text/css"
        href="{{ url_for('static', filename='css/source_file.css') }}" />

{% endblock %}

{% block title %}File: {{ file }}{% endblock %}

{% block source_content %}
<h2>{{ self.title() }}</h2>

<div id="codewrap">
  <div id="codecaption">
    File {{ file }} ({{ nlines }} line{% if nlines > 1 %}s{% endif %})
    | <a href="{{ url_for('source_html', path_to='/'.join(path.split('/')[:-1])) }}">Return to parent folder</a>
    | <a href="{{ raw_url }}">Download raw file</a>
  </div>
  <table id="codetable">
    <tr>
      <td>
        <pre id="sourceslinenumbers">{% for i in range(1, nlines+1) -%}
          <a id="L{{ i }}" href="#L{{ i }}">{{ i }}</a><br />
          {%- endfor %}</pre>
      </td>
      <td>
        <pre><code id="sourcecode" {% if file_language -%}
                      class="{{ file_language }}"
                   {%- endif %}>{% for (line, highlight) in code -%}
            {% if highlight -%}
              <span class="highlight">{{ line }}</span>{% else -%}
              {{ line }}
            {%- endif %}
        {%- endfor %}</code></pre>
      </td>
      <td>
        <pre id="messages">{% if msg -%}
          {% for i in range(1, msg.position) -%}
            <br />
            {%- endfor %}<div class="message">{% if msg.title -%}
              <strong>{{ msg.title }}</strong><br />
            {%- endif %}{% if msg.message -%}
              {{ msg.message }}
            {%- endif %}</div>{%- endif %}</pre>
      </td>
    </tr>
  </table>
</div>

<script type="text/javascript">
  hljs.highlightBlock(document.getElementById('sourcecode'))
</script>

{% endblock %}
