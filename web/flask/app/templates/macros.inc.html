{#
  Copyright (C) 2013  Matthieu Caneill <matthieu.caneill@gmail.com>
  License: GNU Affero General Public License, version 3 or above.
#}

{# from
http://pythonhosted.org/Flask-SQLAlchemy/api.html#flask.ext.sqlalchemy.Pagination.iter_pages #}
{% macro render_pagination(pagination, endpoint) %}
  <div class="pagination">
  {%- for page in pagination.iter_pages(left_edge=5, left_current=5, right_current=5, right_edge=5) %}
    {% if page %}
      {% if page != pagination.page %}
        <a href="{{ url_for(endpoint, page=page) }}">{{ page }}</a>
      {% else %}
        <strong>{{ page }}</strong>
      {% endif %}
    {% else %}
      <span class="ellipsis">â€¦</span>
    {% endif %}
  {%- endfor %}
  </div>
{% endmacro %}

{% macro searchform(form, display="block") -%}
  <form action="{{ url_for('receive_search') }}" name="searchform"
        method="post" style="display: {{ display }};">
      {{ form.query(**kwargs) }}
    {% for error in form.errors.query %}
      {% if display == "block" %}<br />{% endif %}
      <strong>{{ error }}</strong>
    {% endfor %}
    <input type="submit" value="Search package" />
  </form>
{%- endmacro %}


{% macro render_packages_prefixes(prefixes) %}
  {%- for prefix in prefixes %}
    <a href="{{ url_for('prefix_html', prefix=prefix) }}">{{ prefix }}</a>
  {%- endfor %}
{% endmacro %}

{% macro listpackages(packages, columns=1) -%}
  {% if packages|length % columns == 0 %}
    {% set per_column = packages|length // columns %}
  {% else %}
    {% set per_column = packages|length // columns + 1 %}
  {% endif %}
  {% for i in range(columns) %}
    <ul class="listcolumn">
      {% set skip = i * per_column %}
      {% for package in packages[skip:skip + per_column] %}
        <li><a href="{{ url_for('source_html', path_to=package.name) }}">
            {{ package.name }}</a></li>
      {% endfor %}
    </ul>
  {% endfor %}
{%- endmacro %}
