#    -*- mode: org -*-

**Note*: Debsources bugs are now at
https://bugs.debian.org/cgi-bin/pkgreport.cgi?pkg=qa.debian.org;tag=debsources
The entries remaining below are in wait of triaging/forwarding there.

* TODO check-in derivatives from the census		  :infra:derivatives:

* TODO update-debsources --trigger should skip update stages	      :infra:
  At the very least it should skip: update statistics, update charts, update
  suites mappings. Should it become a separate tool? Or should we expose on the
  cmdline the support to select individual update stages? (see updater.py)

* TODO suite test data: differentiate sid and jessie		       :test:
  Currently, the set of packages in sid and jessie are exactly the same. Add
  one or more packages which is in sid but not in jessie.

* TODO debian cross reference (lxr.debian.net)			  :web:ctags:
  A-la http://lxr.linux.no/ . Suggested by Pierre Habouzit. Main problem is of
  scope, cross-ref is mostly reasonable within the same package; /possibly/
  reasonable between dependent packages; largely unresonable among unrelated
  packages. (Not to mention the risk of cross-referincing across different
  languages; although we should have the info to avoid that...)

* TODO make web UI parts conditional on plugin enablement	  :infra:web:

* TODO shutter effect					    :web:hilight:css:
  When we highlight a line, we have to use a display:inline tag (whose
  rendering isn't cool, because an highlighted block doesn't have the
  same width verywhere). With a display:blog tag, newlines are added
  by the browser/highlight.js (?), because tags conflicts with
  highlight.js tags (when a hl.js lexem is multiline).
  Try to highlight lines 3-4 of this to see the bug:

  def hello():
     """aaa
     aaa
     """ zzz = 3

  Edit: the browser close tags automatically, and since our tags
  aren't correct (ie
  <span class="string"><div class="highlight">foo</span></div>
  ), closing display:block tags are inserted.

 Debugging: maybe with inline-block and other css tricks

* TODO migrate to sources.debian.org				  :infra:dsa:
  conversation started by Zack with DSA
  Message-ID: <20131229152159.GA8400@upsilon.cc>

* TODO bulk ctags insertion traceback		:ctags:bulk:traceback:ATTACH:
  :PROPERTIES:
  :Attachments: 1.3.1-4.ctags
  :ID:       b9a3371f-6e2d-4e60-82e4-9d7c7543ba86
  :END:
    Traceback (most recent call last):
      File "bin/bulk-insert-ctags", line 94, in <module>
        main(conf, ctagsfile=args.file)
      File "bin/bulk-insert-ctags", line 73, in main
        insert_ctags(conn, ctagsfile)
      File "bin/bulk-insert-ctags", line 65, in insert_ctags
        conn.execute(INSERT_CTAGS_Q, ctags)
      File "/usr/lib/python2.7/dist-packages/sqlalchemy/engine/base.py", line 1449, in execute
        params)
      File "/usr/lib/python2.7/dist-packages/sqlalchemy/engine/base.py", line 1584, in _execute_clauseelement
        compiled_sql, distilled_params
      File "/usr/lib/python2.7/dist-packages/sqlalchemy/engine/base.py", line 1698, in _execute_context
        context)
      File "/usr/lib/python2.7/dist-packages/sqlalchemy/engine/base.py", line 1680, in _execute_context
        context)
      File "/usr/lib/python2.7/dist-packages/sqlalchemy/engine/default.py", line 328, in do_executemany
        cursor.executemany(statement, parameters)
    sqlalchemy.exc.ProgrammingError: (ProgrammingError) can't adapt type 'RowProxy' '\n    INSERT INTO ctags (version_id, tag, path, line, kind, language)\n    VALUES (%(version_id)s, %(tag)s, %(path)s, %(line)s, %(kind)s, %(language)s)\n    ' ({'kind': 'f', 'language': 'sh', 'version_id': (38474,), 'tag': u'is_absolute', 'path': <psycopg2._psycopg.Binary object at 0x2800248>, 'line': 51}, {'kind': 'f', 'language': 'sh', 'version_id': (38474,), 'tag': u'absolute_or_prefix', 'path': <psycopg2._psycopg.Binary object at 0x2800200>, 'line': 57}, {'kind': 'f', 'language': 'sh', 'version_id': (38474,), 'tag': u'showhelp', 'path': <psycopg2._psycopg.Binary object at 0x2800290>, 'line': 65}, {'kind': 'f', 'language': 'sh', 'version_id': (38474,), 'tag': u'yorn', 'path': <psycopg2._psycopg.Binary object at 0x2800320>, 'line': 202}, {'kind': 'f', 'language': 'sh', 'version_id': (38474,), 'tag': u'nory', 'path': <psycopg2._psycopg.Binary object at 0x2800368>, 'line': 207}, {'kind': 'f', 'language': 'sh', 'version_id': (38474,), 'tag': u'message', 'path': <psycopg2._psycopg.Binary object at 0x28003b0>, 'line': 213}, {'kind': 'f', 'language': 'sh', 'version_id': (38474,), 'tag': u'info', 'path': <psycopg2._psycopg.Binary object at 0x28003f8>, 'line': 214}, {'kind': 'f', 'language': 'sh', 'version_id': (38474,), 'tag': u'warning', 'path': <psycopg2._psycopg.Binary object at 0x2800440>, 'line': 215}  ... displaying 10 of 436 total bound parameter sets ...  {'kind': 'f', 'language': 'sh', 'version_id': (38474,), 'tag': u'duplex', 'path': <psycopg2._psycopg.Binary object at 0x2a11e18>, 'line': 734}, {'kind': 'f', 'language': 'sh', 'version_id': (38474,), 'tag': u'viewps', 'path': <psycopg2._psycopg.Binary object at 0x2a11e60>, 'line': 757})

  test recipe (bulk):
  - find /srv/debsources/sources -mindepth 4 -maxdepth 4 -name '*.ctags > ctags.txt
  - while read f ; do bin/bulk-insert-ctags -c etc/config.batch.ini $f ; done < ctags.txt

  test recipe (single file):
  - bin/bulk-insert-ctags -c etc/config.batch.ini 1.3.1-4.ctags
    (see attachment)

* TODO refactor app/views.py 					 :web:python:
  The GeneralView object should be inheritated to PaginationView, in
  order for all routes which use pagination (ctags, checksums, etc) to
  automatically have these features. In this case, the json view is
  not paginated but the html view is.

* TODO ability to "edit" files						:web:
  every file exposed should have a edit file (maybe only for some users) a-la
  GitHub. The result of the edit actionn will be returned as debdiff against
  the whole package, so that it could be submitted as an easy to import patch
  to the Debian BTS. Bonus point (but more difficult): have real editing
  sessions, in which more than one file could be edited.

  Credit: Raphael Geissert after DebConf14 talk

