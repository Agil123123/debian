#!/bin/bash

# Iterate a given command in each unpacked source package dir
#
# Usage: foreach COMMAND...

root="/srv/debsources"
source "$root/etc/config.sh"
source "$root/bin/lib.sh"

srclist="$sources_list"

if [ -z "$1" ] ; then
    err "Usage: foreach COMMAND..." 2
fi

cat $srclist | \
while read package version area dsc dest ; do
    if ! [ -d "$dest" ] ; then
	warn "directory for ${package}/${version} does not exist, skipping."
    else
	(cd "$dest" && \
	    export DEBSOURCES_PACKAGE="$package" && \
	    export DEBSOURCES_VERSION="$version" && \
	    export DEBSOURCES_AREA="$area" &&
	    export DEBSOURCES_DSC="$dsc" &&
	    export DEBSOURCES_DEST="$dest" &&
	    eval "$@")
    fi
done
